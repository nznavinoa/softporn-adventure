import React, { useState, useEffect } from 'react';
import { Terminal } from 'lucide-react';

const NeonSoftpornAdventure = () => {
  const [gameState, setGameState] = useState({
    currentLocation: 3, // Start in the bar (location 3)
    inventory: [],
    score: 0,
    money: 1000, // Starting money ($1000)
    gameText: [],
    inputValue: '',
    hasLoaded: false
  });

  const locationDescriptions = {
    1: "I'M IN A HALLWAY.",
    2: "I'M IN A BATHROOM.",
    3: "I'M IN A SLEAZY BAR.",
    4: "I'M ON A STREET OUTSIDE THE BAR.",
    5: "I'M IN THE BACKROOM.",
    6: "I'M IN A FILTHY DUMPSTER!",
    7: "I'M INSIDE THE ROOM I BROKE INTO!",
    8: "I'M ON A WINDOW LEDGE.",
    9: "I'M IN A HOOKER'S BEDROOM.",
    10: "I'M ON A HOOKER'S BALCONY.",
    11: "I'M ON A DOWNTOWN STREET.",
    12: "I'M IN A QUICKIE MARRIAGE CENTER.",
    13: "I'M IN THE MAIN CASINO ROOM.",
    14: "I'M IN THE '21 ROOM'.",
    15: "I'M IN THE LOBBY OF THE HOTEL.",
    16: "I'M IN THE HONEYMOON SUITE.",
    17: "I'M IN THE HOTEL HALLWAY.",
    18: "I'M ON THE HONEYMOONER'S BALCONY.",
    19: "I'M AT THE HOTEL DESK.",
    20: "I'M IN A TELEPHONE BOOTH.",
    21: "I'M IN THE DISCO.",
    22: "I'M ON A RESIDENTIAL STREET.",
    23: "I'M IN THE DISCO'S ENTRANCE.",
    24: "I'M IN THE PHARMACY.",
    25: "I'M IN THE PENTHOUSE FOYER.",
    26: "I'M IN THE JACUZZI!",
    27: "I'M IN THE KITCHEN.",
    28: "I'M IN THE GARDEN.",
    29: "I'M IN THE LIVING ROOM.",
    30: "I'M ON THE PENTHOUSE PORCH."
  };

  // Items in each location
  const locationItems = {
    1: ["A DESK", "A BUSINESSMAN"],
    2: ["A WASHBASIN", "A TOILET", "GRAFITTI", "A MIRROR"],
    3: ["THE BARTENDER", "A BIG DUDE!", "A BUTTON", "A CURTAIN"],
    4: ["A BILLBOARD"],
    5: ["A TV", "A TABLE"],
    9: ["A FUNKY HOOKER", "A BED"],
    13: ["SLOT MACHINES"],
    14: ["CARDS", "A DEALER"],
    19: ["A VOLUPTOUS BLONDE"],
    21: ["A GIRL"],
    24: ["A DISPLAY RACK", "ADVENTUREBOY MAGAZINE", "A RUBBER"],
    26: ["A GIRL"],
    28: ["BUSHES", "A TREE"],
  };

  const directions = {
    1: "NORTH AND EAST",
    2: "SOUTH",
    3: "NORTH AND WEST",
    4: "NORTH, EAST AND WEST",
    5: "WEST AND UP",
    6: "WEST",
    7: "NORTH",
    8: "SOUTH AND EAST",
    9: "NORTH AND DOWN",
    10: "SOUTH AND DOWN",
    11: "SOUTH, EAST AND WEST",
    12: "EAST AND UP",
    13: "SOUTH, WEST AND DOWN",
    14: "WEST AND DOWN",
    15: "SOUTH AND WEST",
    16: "BY MAGIC!",
    17: "NORTH, EAST AND UP",
    18: "UP",
    19: "EAST"
  };

  // Initial game setup
  useEffect(() => {
    if (!gameState.hasLoaded) {
      setGameState(prevState => ({
        ...prevState,
        gameText: [
          "SOFTPORN ADVENTURE",
          "WRITTEN BY CHUCK BENTON",
          "COPYRIGHT 1981",
          "BLUE SKY SOFTWARE",
          "",
          "80s NEON REMAKE",
          "",
          locationDescriptions[prevState.currentLocation],
          "",
          `ITEMS IN SIGHT ARE: ${locationItems[prevState.currentLocation]?.join(", ") || "NOTHING AT ALL!!!!!"}`,
          "",
          `OTHER AREAS ARE: ${directions[prevState.currentLocation] || "NOWHERE"}`
        ],
        hasLoaded: true
      }));
    }
  }, [gameState.hasLoaded]);

  const handleInput = (e) => {
    e.preventDefault();
    const command = gameState.inputValue.toUpperCase();
    let response = '';

    if (command === 'N' || command === 'NORTH') {
      response = movePlayer('NORTH');
    } else if (command === 'S' || command === 'SOUTH') {
      response = movePlayer('SOUTH');
    } else if (command === 'E' || command === 'EAST') {
      response = movePlayer('EAST');
    } else if (command === 'W' || command === 'WEST') {
      response = movePlayer('WEST');
    } else if (command === 'LOOK') {
      response = lookAround();
    } else if (command === 'I' || command === 'INVENTORY') {
      response = showInventory();
    } else if (command === 'SCORE') {
      response = `YOUR SCORE IS ${gameState.score} OUT OF '3'`;
    } else if (command === 'QUIT' || command === 'Q') {
      response = "SAVE GAME?? (Y/N)";
    } else if (command.startsWith('PLAY')) {
      if (gameState.currentLocation === 13 && command.includes('SLOT')) {
        response = playSlots();
      } else if (gameState.currentLocation === 14 && command.includes('21')) {
        response = "THIS WILL COST $100 EACH TIME\nYOU HAVE $" + (gameState.money/100) + "00\nWOULD YOU LIKE TO PLAY? (Y/N)";
      } else {
        response = "PLAYFUL BUGGER, EH??";
      }
    } else {
      // Parse more complex commands
      const words = command.split(' ');
      const verb = words[0];
      const noun = words.length > 1 ? words[1] : '';
      
      response = parseCommand(verb, noun);
    }

    // Add command and response to game text
    setGameState(prevState => ({
      ...prevState,
      gameText: [...prevState.gameText, `> ${prevState.inputValue}`, response],
      inputValue: ''
    }));
  };

  const movePlayer = (direction) => {
    const currentLoc = gameState.currentLocation;
    let newLoc = currentLoc;
    let allowedDirections = [];
    
    // Determine allowed directions based on the current location
    if (directions[currentLoc]) {
      const dirString = directions[currentLoc];
      if (dirString.includes("NORTH")) allowedDirections.push("NORTH");
      if (dirString.includes("SOUTH")) allowedDirections.push("SOUTH");
      if (dirString.includes("EAST")) allowedDirections.push("EAST");
      if (dirString.includes("WEST")) allowedDirections.push("WEST");
      if (dirString.includes("UP")) allowedDirections.push("UP");
      if (dirString.includes("DOWN")) allowedDirections.push("DOWN");
    }
    
    if (!allowedDirections.includes(direction)) {
      return "I CAN'T GO IN THAT DIRECTION!!";
    }
    
    // Simple movement map (this is a simplified version)
    if (direction === "NORTH") {
      if (currentLoc === 3) newLoc = 1;
      else if (currentLoc === 4) newLoc = 3;
      else if (currentLoc === 9) newLoc = 5;
    } else if (direction === "SOUTH") {
      if (currentLoc === 1) newLoc = 3;
      else if (currentLoc === 3) newLoc = 4;
      else if (currentLoc === 5) newLoc = 9;
    } else if (direction === "EAST") {
      if (currentLoc === 1) newLoc = 2;
      else if (currentLoc === 4) newLoc = 11;
      else if (currentLoc === 11) newLoc = 13;
    } else if (direction === "WEST") {
      if (currentLoc === 2) newLoc = 1;
      else if (currentLoc === 11) newLoc = 4;
      else if (currentLoc === 13) newLoc = 11;
    }
    
    if (newLoc === currentLoc) {
      return "I CAN'T GO IN THAT DIRECTION!!";
    }
    
    setGameState(prevState => ({
      ...prevState,
      currentLocation: newLoc
    }));
    
    return [
      locationDescriptions[newLoc],
      "",
      `ITEMS IN SIGHT ARE: ${locationItems[newLoc]?.join(", ") || "NOTHING AT ALL!!!!!"}`,
      "",
      `OTHER AREAS ARE: ${directions[newLoc] || "NOWHERE"}`
    ].join("\n");
  };

  const lookAround = () => {
    const currentLoc = gameState.currentLocation;
    return [
      locationDescriptions[currentLoc],
      "",
      `ITEMS IN SIGHT ARE: ${locationItems[currentLoc]?.join(", ") || "NOTHING AT ALL!!!!!"}`,
      "",
      `OTHER AREAS ARE: ${directions[currentLoc] || "NOWHERE"}`
    ].join("\n");
  };

  const showInventory = () => {
    if (gameState.inventory.length === 0) {
      return "I'M CARRYING THE FOLLOWING:\nNOTHING!!";
    }
    return "I'M CARRYING THE FOLLOWING:\n" + gameState.inventory.join(", ");
  };

  const playSlots = () => {
    if (gameState.money < 100) {
      return "I'M BROKE!!!- THAT MEANS DEATH!!!!!!!!";
    }
    
    // Simple slot machine simulation
    const symbols = ["$", "#", "@", "&", "%", "!", "*"];
    const slot1 = symbols[Math.floor(Math.random() * symbols.length)];
    const slot2 = symbols[Math.floor(Math.random() * symbols.length)];
    const slot3 = symbols[Math.floor(Math.random() * symbols.length)];
    
    let winnings = 0;
    let message = `${slot1} | ${slot2} | ${slot3}\n`;
    
    if (slot1 === slot2 && slot2 === slot3) {
      winnings = 1500;
      message += "TRIPLES!!!!!! YOU WIN $1500";
    } else if (slot1 === slot2 || slot2 === slot3 || slot1 === slot3) {
      winnings = 300;
      message += "A PAIR! YOU WIN $300";
    } else {
      message += "YOU LOSE!";
    }
    
    const newMoney = gameState.money - 100 + winnings;
    
    setGameState(prevState => ({
      ...prevState,
      money: newMoney
    }));
    
    return message + `\nYOU NOW HAVE $${newMoney/100}00`;
  };

  const parseCommand = (verb, noun) => {
    // This is where we'd implement the complex command parsing
    // For demo purposes, just returning some appropriate responses
    
    if (verb === 'TAKE' || verb === 'GET') {
      const currentItems = locationItems[gameState.currentLocation] || [];
      const matchingItems = currentItems.filter(item => item.includes(noun));
      
      if (matchingItems.length > 0) {
        // In a real implementation, we'd need to update the location items as well
        setGameState(prevState => ({
          ...prevState,
          inventory: [...prevState.inventory, matchingItems[0]]
        }));
        return `OK, I TOOK ${matchingItems[0]}`;
      } else {
        return "I DON'T SEE IT HERE!!";
      }
    }
    
    if (verb === 'DROP') {
      const matchingItems = gameState.inventory.filter(item => item.includes(noun));
      
      if (matchingItems.length > 0) {
        setGameState(prevState => ({
          ...prevState,
          inventory: prevState.inventory.filter(item => !item.includes(noun))
        }));
        return `OK, I DROPPED ${matchingItems[0]}`;
      } else {
        return "I DON'T HAVE IT!!";
      }
    }
    
    if (verb === 'EXAMINE' || verb === 'LOOK' || verb === 'READ') {
      if (noun === 'GRAFITTI' && gameState.currentLocation === 2) {
        return "AT MY APPLE IS WHERE I SIT,\nWHEN I FEEL LIKE FONDLING IT'S BITS!\nTHE PASSWORD IS: BELLYBUTTON";
      }
      if (noun === 'BILLBOARD' && gameState.currentLocation === 4) {
        return "FOR THOSE WHO DESIRE THE BEST:\nANNOUNCING\nTHE MOST EXCLUSIVE,\nTHE EXCITING,\nTHE HOTTEST SPOT IN TOWN,\nSWINGING SINGLE'S DISCO";
      }
      if (noun === 'MAGAZINE' && gameState.inventory.includes("ADVENTUREBOY MAGAZINE")) {
        return "THE FEATURE ARTICLE IS ABOUT HOW TO PICK UP AN INNOCENT GIRL AT A DISCO.\nIT SAYS- 'SHOWER HER WITH PRESENTS. DANCING WON'T HURT EITHER. AND WINE IS ALWAYS GOOD TO GET THINGS MOVING!'";
      }
    }
    
    if (verb === 'PUSH' || verb === 'PRESS') {
      if (noun === 'BUTTON' && gameState.currentLocation === 3) {
        return "A VOICE ASKS 'WHATS THE PASSWORD?' (ONE WORD)";
      }
    }
    
    if (verb === 'TV' && gameState.currentLocation === 5) {
      if (noun === 'ON') {
        return "CHOOSE A CHANNEL (1-9)";
      } else {
        return "IT'S TURNED OFF";
      }
    }
    
    if (verb === 'DANCE' && gameState.currentLocation === 21) {
      return "BOOGIE WOOGIE!!!!\nYEH YEH YEH!!!\nI GOT THE STEPS, MAN!!";
    }
    
    return "I DON'T KNOW HOW TO DO THAT.";
  };

  return (
    <div className="flex flex-col h-screen bg-black text-white font-mono overflow-hidden">
      {/* Game title */}
      <div className="bg-purple-900 p-4 text-center border-b-4 border-pink-500">
        <h1 className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 tracking-wider">
          SOFTPORN ADVENTURE
        </h1>
        <div className="text-cyan-400 text-sm mt-1">80s NEON EDITION</div>
      </div>
      
      {/* Game display */}
      <div className="flex-1 overflow-hidden flex flex-col p-4 bg-gradient-to-b from-black to-purple-900 border-l-2 border-r-2 border-cyan-500">
        <div 
          className="flex-1 overflow-y-auto p-4 font-mono text-lg"
          style={{ 
            textShadow: '0 0 5px #0ff, 0 0 10px #0ff',
            background: 'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7))'
          }}
        >
          {gameState.gameText.map((text, index) => (
            <div key={index} className={`mb-2 ${text.startsWith('>') ? 'text-pink-500' : 'text-cyan-300'}`}>
              {text.split('\n').map((line, i) => (
                <div key={i}>{line}</div>
              ))}
            </div>
          ))}
        </div>
        
        {/* Input area */}
        <form onSubmit={handleInput} className="mt-4 flex items-center">
          <div className="w-8 mr-2 text-pink-500">
            <Terminal />
          </div>
          <input
            type="text"
            value={gameState.inputValue}
            onChange={(e) => setGameState({...gameState, inputValue: e.target.value})}
            className="flex-1 bg-black border-2 border-cyan-500 text-cyan-300 p-2 focus:outline-none focus:border-pink-500"
            placeholder="WHAT SHALL I DO?"
            style={{ textShadow: '0 0 5px #0ff' }}
          />
          <button 
            type="submit" 
            className="ml-2 bg-gradient-to-r from-pink-500 to-purple-600 px-4 py-2 text-white font-bold hover:from-pink-600 hover:to-purple-700"
          >
            ENTER
          </button>
        </form>
      </div>
      
      {/* Status bar */}
      <div className="bg-purple-900 p-2 border-t-4 border-pink-500 flex justify-between">
        <div className="text-cyan-400">SCORE: {gameState.score}/3</div>
        <div className="text-cyan-400">MONEY: ${gameState.money/100}00</div>
        <div className="text-pink-500">LOCATION: {gameState.currentLocation}</div>
      </div>
    </div>
  );
};

export default NeonSoftpornAdventure;